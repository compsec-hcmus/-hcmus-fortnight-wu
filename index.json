{"name":"write-up","tags":[],"detail":"","list":[{"name":"Fortnight_Challenge_2022","tags":[],"detail":"","list":[{"name":"Cryptography","tags":[],"detail":"","list":[{"name":"Deco de Crypto","tags":["https://img.shields.io/badge/Category-Cryptography-brightgreen.svg","https://img.shields.io/badge/Score_after_CTF-200-blue.svg","https://img.shields.io/badge/Author-SpookyFish%234588-blue.svg","https://img.shields.io/badge/Solves-34-lightgrey.svg"],"detail":"<h1>Fortnight challenge 2022: Deco de Crypto</h1><p><img src=\"https://img.shields.io/badge/Category-Cryptography-brightgreen.svg\" alt=\"warmup category\"><br><img src=\"https://img.shields.io/badge/Score_after_CTF-200-blue.svg\" alt=\"score\"><br><img src=\"https://img.shields.io/badge/Author-SpookyFish%234588-blue.svg\" alt=\"author\"><br><img src=\"https://img.shields.io/badge/Solves-34-lightgrey.svg\" alt=\"solves\"></p><h2>Description</h2><p>My friend Deco de Crypto sent me this and challenged me to find his message. But how am I supposed to crack this code?</p><h2>Hints</h2><ul><li>None</li></ul><h2>Attached files</h2><ul><li><a href=\"https://raw.githubusercontent.com/compsec-hcmus/hcmus-fortnight-wu/main/Deco%20de%20Crypto/encoded\">encoded</a></li></ul><h2>Summary</h2><p>I used base 32 decode and base 64 decode</p><h2>Detailed solution</h2><p>[Provide the detailed solution of the ctf here.]Some rules:Name of tool, name of file, name of functions, etc: put in 1 set of backtick:  <code>name of something</code>Code snippet, console output, other long multilines of text: put in 3 sets of backticks on a new line:<code>code snippet</code>Key ideas, name of person who invented the method, etc: put in bold <strong>name of someone</strong></p><p>[some more rules here]</p><h2>Flag</h2><pre><code>f0rtn1ght{n01ce_ba5e5}</code></pre>","list":[]}]},{"name":"RE","tags":[],"detail":"","list":[{"name":"ARGGGGH","tags":["https://img.shields.io/badge/Category-Reverse_Engineering-brightgreen.svg","https://img.shields.io/badge/Author-xikhud-blue.svg"],"detail":"<h2>ARGGGGH</h2><p><img src=\"https://img.shields.io/badge/Category-Reverse_Engineering-brightgreen.svg\" alt=\"Category\"><br><img src=\"https://img.shields.io/badge/Author-xikhud-blue.svg\" alt=\"Author\"></p><h3>Description</h3><p>Can you crack the password for this challenge? If you think you can, prove it. Good luck!</p><h3>Summary</h3><p>Bài này sử dụng hai thuật toán nổi tiếng là RC4 và Base64. Ngoài ra nó còn sử dụng thủ thuật <a href=\"https://github.com/adamyaxley/Obfuscate\">compile-time string literal obfuscation</a>.</p><h3>Detailed solution</h3><p>Hàm <code>main</code>:</p><pre><code class=\"language-c\">__int64 __fastcall <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> a1, <span class=\"hljs-type\">char</span> **a2, <span class=\"hljs-type\">char</span> **a3)</span>{  <span class=\"hljs-comment\">// [COLLAPSED LOCAL DECLARATIONS. PRESS KEYPAD CTRL-&quot;+&quot; TO EXPAND]</span>  v19 = __readfsqword(<span class=\"hljs-number\">0x28</span>u);  v3 = sub_1588();  v4 = (<span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *)sub_1E84((__int64)v3);  <span class=\"hljs-built_in\">printf</span>(v4);  fgets(s, <span class=\"hljs-number\">256</span>, <span class=\"hljs-built_in\">stdin</span>);  s[<span class=\"hljs-built_in\">strlen</span>(s) - <span class=\"hljs-number\">1</span>] = <span class=\"hljs-number\">0</span>;  v16 = sub_24D9(s);  v5 = <span class=\"hljs-built_in\">strlen</span>(v16);  s1 = (<span class=\"hljs-type\">char</span> *)<span class=\"hljs-built_in\">calloc</span>(v5 + <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1uLL</span>);  v6 = sub_16CC();  v7 = sub_1F32((__int64)v6);  sub_1500(v7, (__int64)v16, (__int64)s1);  v8 = sub_1844();  v9 = (<span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *)sub_1FE0((__int64)v8);  <span class=\"hljs-keyword\">if</span> ( !<span class=\"hljs-built_in\">strcmp</span>(s1, v9) )  {    v10 = sub_19CC();    v11 = (<span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *)sub_208E((__int64)v10);    <span class=\"hljs-built_in\">printf</span>(v11, s);  }  <span class=\"hljs-keyword\">else</span>  {    v12 = sub_1AE8(&amp;v15);    v13 = (<span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *)sub_213C(v12);    <span class=\"hljs-built_in\">printf</span>(v13);  }  <span class=\"hljs-built_in\">free</span>(s1);  <span class=\"hljs-built_in\">free</span>(v16);  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0LL</span>;}</code></pre><p>Để ý rằng trong đoạn code trên có một số pattern như sau:</p><pre><code class=\"language-c\">v3 = sub_XXXX();v4 = (<span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *)sub_YYYY((__int64)v3);<span class=\"hljs-built_in\">printf</span>(v4); <span class=\"hljs-comment\">// use v4, don&#x27;t have to be printf</span></code></pre><p>Trong đó hàm <code>sub_XXXX</code> và <code>sub_YYYY</code> trông giống giống như sau:</p><pre><code class=\"language-c\"><span class=\"hljs-type\">void</span> *<span class=\"hljs-title function_\">sub_XXXX</span><span class=\"hljs-params\">()</span>{  <span class=\"hljs-type\">char</span> v1[<span class=\"hljs-number\">40</span>]; <span class=\"hljs-comment\">// [rsp+20h] [rbp-40h] BYREF</span>  <span class=\"hljs-type\">unsigned</span> __int64 v2; <span class=\"hljs-comment\">// [rsp+48h] [rbp-18h]</span>  v2 = __readfsqword(<span class=\"hljs-number\">0x28</span>u);  v1[<span class=\"hljs-number\">0</span>] = <span class=\"hljs-number\">71</span>;  v1[<span class=\"hljs-number\">1</span>] = <span class=\"hljs-number\">-12</span>;  v1[<span class=\"hljs-number\">2</span>] = <span class=\"hljs-number\">-101</span>;  v1[<span class=\"hljs-number\">3</span>] = <span class=\"hljs-number\">43</span>;  v1[<span class=\"hljs-number\">4</span>] = <span class=\"hljs-number\">-119</span>;  v1[<span class=\"hljs-number\">5</span>] = <span class=\"hljs-number\">71</span>;  v1[<span class=\"hljs-number\">6</span>] = <span class=\"hljs-number\">-113</span>;  v1[<span class=\"hljs-number\">7</span>] = <span class=\"hljs-number\">119</span>;  v1[<span class=\"hljs-number\">8</span>] = <span class=\"hljs-number\">121</span>;  v1[<span class=\"hljs-number\">9</span>] = <span class=\"hljs-number\">-20</span>;  v1[<span class=\"hljs-number\">10</span>] = <span class=\"hljs-number\">-101</span>;  v1[<span class=\"hljs-number\">11</span>] = <span class=\"hljs-number\">56</span>;  v1[<span class=\"hljs-number\">12</span>] = <span class=\"hljs-number\">-38</span>;  v1[<span class=\"hljs-number\">13</span>] = <span class=\"hljs-number\">86</span>;  v1[<span class=\"hljs-number\">14</span>] = <span class=\"hljs-number\">-57</span>;  v1[<span class=\"hljs-number\">15</span>] = <span class=\"hljs-number\">119</span>;  v1[<span class=\"hljs-number\">16</span>] = <span class=\"hljs-number\">55</span>;  v1[<span class=\"hljs-number\">17</span>] = <span class=\"hljs-number\">-24</span>;  v1[<span class=\"hljs-number\">18</span>] = <span class=\"hljs-number\">-97</span>;  v1[<span class=\"hljs-number\">19</span>] = <span class=\"hljs-number\">57</span>;  v1[<span class=\"hljs-number\">20</span>] = <span class=\"hljs-number\">-119</span>;  v1[<span class=\"hljs-number\">21</span>] = <span class=\"hljs-number\">85</span>;  v1[<span class=\"hljs-number\">22</span>] = <span class=\"hljs-number\">-64</span>;  v1[<span class=\"hljs-number\">23</span>] = <span class=\"hljs-number\">96</span>;  v1[<span class=\"hljs-number\">24</span>] = <span class=\"hljs-number\">115</span>;  v1[<span class=\"hljs-number\">25</span>] = <span class=\"hljs-number\">-94</span>;  v1[<span class=\"hljs-number\">26</span>] = <span class=\"hljs-number\">-34</span>;  v1[<span class=\"hljs-number\">27</span>] = <span class=\"hljs-number\">74</span>;  <span class=\"hljs-keyword\">if</span> ( (_BYTE)byte_5060 || !__cxa_guard_acquire(&amp;byte_5060) )    <span class=\"hljs-keyword\">return</span> &amp;unk_5040;  sub_1DF8(&amp;unk_5040, v1);  __cxa_guard_release(&amp;byte_5060);  __cxa_atexit(func, &amp;unk_5040, &amp;dso_handle);  <span class=\"hljs-keyword\">return</span> &amp;unk_5040;}__int64 __fastcall <span class=\"hljs-title function_\">sub_YYYY</span><span class=\"hljs-params\">(__int64 a1)</span>{  __int64 result; <span class=\"hljs-comment\">// rax</span>  result = *(<span class=\"hljs-type\">unsigned</span> __int8 *)(a1 + <span class=\"hljs-number\">28</span>);  <span class=\"hljs-keyword\">if</span> ( !(_BYTE)result )    <span class=\"hljs-keyword\">return</span> result;  sub_1D91(a1, <span class=\"hljs-number\">28LL</span>, <span class=\"hljs-number\">0x12AF22FA4AFE9817</span>LL); <span class=\"hljs-comment\">// xor with [0x17, 0x98, 0xFE, 0x4A, 0xFA, 0x22, 0xAF, 0x12]</span>  result = a1;  *(_BYTE *)(a1 + <span class=\"hljs-number\">28</span>) = <span class=\"hljs-number\">0</span>;  <span class=\"hljs-keyword\">return</span> result;}</code></pre><p>Khi đó đoạn code trên sẽ xor <code>[71, -12, -101, 43, ...]</code> với <code>[0x17, 0x98, 0xFE, 0x4A, 0xFA, 0x22, 0xAF, 0x12]</code> cho ra chuỗi <code>&quot;Please enter the password: &quot;</code></p><p>Các pattern khác làm tương tự. Đây chính là <a href=\"https://github.com/adamyaxley/Obfuscate\">compile-time string literal obfuscation</a>.</p><p>Đầu tiên input của chúng ta được đưa vào hàm <code>sub_24D9</code>. Hàm này thực chất là hàm base64 encode, nhưng làm sao để nhận diện hàm này? Có 1 số cách:</p><ul><li>Dùng debugger để quan sát return value sau khi chạy hàm này, sẽ thấy tất cả các character của nó đều thuộc khoảng A-Z, a-z, 0-9 và +, /.</li><li>Đọc code của hàm <code>sub_24D9</code> thấy có chỗ <code>malloc(4 * v1 / 3 + 4)</code> với <code>v1</code> là độ dài chuỗi input. Thuật toán encode mà làm cho độ dài của chuỗi dài thêm 4/3 lần chính là base64.</li></ul><p>Tuy nhiên khi các bạn quan sát giá trị sau khi base64 encode thì sẽ thấy nó không chính xác so với việc các bạn tự encode. Đó là vì hàm base64 encode của mình sử dụng custom alphabet (xem hàm <code>sub_2302</code>).</p><p><code>abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ+/</code></p><p>Sau khi được base64 encode, nó lại được RC4 encrypt tại hàm <code>sub_1500</code>. Có 1 số cách để biết được hàm này là RC4, đã được viết trên fanpage, <a href=\"https://www.facebook.com/hcmus.compsec.club/posts/482321203493081\">tại đây</a>.</p><p>Cuối cùng, sau khi được RC4 encrypt (với key là <code>&quot;YEKDx2ZoxDcCFZzjnhx8Vx8y9mp7DySPhKipmz0s&quot;</code>), nó sẽ được so sánh với một chuỗi hardcode bằng hàm <code>strcmp</code>. Từ đó ta dễ dàng tìm được flag là</p><pre><code>flag = CustomBase64(RC4Decrypt(hardcode_string,  &quot;YEKDx2ZoxDcCFZzjnhx8Vx8y9mp7DySPhKipmz0s&quot;))</code></pre><p><img src=\"img.png\" alt=\"\"><a href=\"https://gchq.github.io/CyberChef/#recipe=From_Hex('%5C%5Cx')RC4(%7B'option':'UTF8','string':'YEKDx2ZoxDcCFZzjnhx8Vx8y9mp7DySPhKipmz0s'%7D,'Latin1','Latin1')From_Base64('abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ%2B/',true)&amp;input=XHhjNVx4ZjRceGNlXHgwM1x4MmFceGQyXHhmZlx4MzhceDFlXHhiZFx4NjdceDQ5XHhlNFx4MTBceGU2XHg4Nlx4MTFceGU4XHgzYlx4MTBceDE4XHg4Nlx4ZGZceGVmXHhhOFx4YTdceDk4XHgzOFx4NjlceGFiXHhjNFx4ZWVceGUxXHg1YVx4NGFceDU0XHg4Ylx4ZTFceDAzXHgyMVx4NWNceGFmXHgxM1x4NmU\">----------------------- Link để test -----------------------</a>.</p><h3>Flag</h3><pre><code>f0rtn1ght{arc4_And_base64_boizzz}</code></pre>","list":[]},{"name":"SecureKeygen","tags":["https://img.shields.io/badge/Category-Reverse_Engineering-brightgreen.svg","https://img.shields.io/badge/Author-xikhud-blue.svg"],"detail":"<h2>SecureKeygen</h2><p><img src=\"https://img.shields.io/badge/Category-Reverse_Engineering-brightgreen.svg\" alt=\"Category\"><br><img src=\"https://img.shields.io/badge/Author-xikhud-blue.svg\" alt=\"Author\"></p><h3>Description</h3><p>You dont have to buy a license if you can generate one. Please find a correct key for user “hcmus@fortnight”. The flag will be “f0rtn1ght{key}” (key is in lowercase)</p><h3>Hints</h3><ol><li>Check function is written in C, not Java.</li><li><a href=\"https://www.ragingrock.com/AndroidAppRE/reversing_native_libs.html\">Reference</a></li><li><a href=\"https://frida.re/\">Instrumentation tool</a></li></ol><h3>Summary</h3><p>Bài này thuật toán tạo key khá dễ, nhưng quan trọng là phải biết hàm tạo key nằm ở chỗ nào.</p><h3>Detailed solution</h3><p>Bài này có hai cách giải, một cách là static, tức là chỉ đọc và phân tích code, còn cách thứ hai là dynamic, ở cách này thay vì hiểu code thì ta sẽ quan sát các giá trị trong hàm check bằng tool <a href=\"https://frida.re/\">frida</a>.</p><p>Đầu tiên mở app lên chạy<img src=\"bluestack.png\" alt=\"\">App khá cơ bản, chỉ có 2 ô để nhập input và một nút check. Ta cần tìm một key hợp lệ cho <code>&quot;hcmus@fortnight&quot;</code>. Để decompile file apk, ta dùng tool <a href=\"https://github.com/skylot/jadx\">jadx</a> hoặc bất cứ tool nào mà các bạn biết là nó có thể decompile file apk.</p><pre><code class=\"language-java\"><span class=\"hljs-keyword\">package</span> com.example.securekeygen;<span class=\"hljs-keyword\">import</span> android.os.Bundle;<span class=\"hljs-keyword\">import</span> android.view.View;<span class=\"hljs-keyword\">import</span> android.widget.Button;<span class=\"hljs-keyword\">import</span> android.widget.EditText;<span class=\"hljs-keyword\">import</span> android.widget.Toast;<span class=\"hljs-keyword\">import</span> androidx.appcompat.app.AppCompatActivity;<span class=\"hljs-comment\">/* loaded from: classes.dex */</span><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MainActivity</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">AppCompatActivity</span> {    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">native</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">check</span><span class=\"hljs-params\">(String str, String str2)</span>;    <span class=\"hljs-keyword\">static</span> {        System.loadLibrary(<span class=\"hljs-string\">&quot;nativeCheck&quot;</span>);    }    <span class=\"hljs-meta\">@Override</span> <span class=\"hljs-comment\">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span>    <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">onCreate</span><span class=\"hljs-params\">(Bundle bundle)</span> {        <span class=\"hljs-built_in\">super</span>.onCreate(bundle);        setContentView(R.layout.activity_main);        ((Button) findViewById(R.id.checkButton)).setOnClickListener(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">View</span>.OnClickListener() { <span class=\"hljs-comment\">// from class: com.example.securekeygen.MainActivity.1</span>            <span class=\"hljs-meta\">@Override</span> <span class=\"hljs-comment\">// android.view.View.OnClickListener</span>            <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">onClick</span><span class=\"hljs-params\">(View view)</span> {                <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">obj</span> <span class=\"hljs-operator\">=</span> ((EditText) MainActivity.<span class=\"hljs-built_in\">this</span>.findViewById(R.id.nameEditText)).getText().toString();                <span class=\"hljs-keyword\">if</span> (MainActivity.<span class=\"hljs-built_in\">this</span>.check(obj, ((EditText) MainActivity.<span class=\"hljs-built_in\">this</span>.findViewById(R.id.keyEditText)).getText().toString())) {                    Toast.makeText(MainActivity.<span class=\"hljs-built_in\">this</span>.getApplicationContext(), String.format(<span class=\"hljs-string\">&quot;Nice, you have entered the correct key of \\&quot;%s\\&quot;&quot;</span>, obj), <span class=\"hljs-number\">0</span>).show();                } <span class=\"hljs-keyword\">else</span> {                    Toast.makeText(MainActivity.<span class=\"hljs-built_in\">this</span>.getApplicationContext(), String.format(<span class=\"hljs-string\">&quot;Wrong key for user \\&quot;%s\\&quot;&quot;</span>, obj), <span class=\"hljs-number\">0</span>).show();                }            }        });    }}</code></pre><p>Ở trên là toàn bộ nội dung của <code>com.example.securekeygen.MainActivity</code>, có thể coi đây là hàm “main” trên app android.Ta muốn vào nhánh in ra màn mình <code>&quot;Nice, you have entered ...&quot;</code>, khi đó cần có:</p><pre><code class=\"language-java\">MainActivity.<span class=\"hljs-built_in\">this</span>.check(obj, ((EditText) MainActivity.<span class=\"hljs-built_in\">this</span>.findViewById(R.id.keyEditText)).getText().toString()) == <span class=\"hljs-literal\">true</span></code></pre><p>Hàm <code>check</code> sẽ thực hiện việc kiểm tra key và name xem có hợp lệ hay không, nhưng nếu nhìn trong đoạn code java của <code>MainActivity</code> thì sẽ không thấy code của hàm <code>check</code> đâu, mà chỉ thấy định nghĩa:</p><pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">native</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">check</span><span class=\"hljs-params\">(String str, String str2)</span>;</code></pre><p>Đó là vì hàm này không được viết bằng code java mà nó được viết bằng C (hoặc C++). Trong <a href=\"https://www.ragingrock.com/AndroidAppRE/reversing_native_libs.html\">link ở hint</a> có hướng dẫn cách reverse những hàm như vậy. Các bạn có thể đọc link trên để tìm hiểu thêm, nhưng mình có thể tóm gọn lại các ý như sau:</p><ul><li>Nếu hàm đó tên là <code>check</code> thì tên hàm khi viết bằng C/C++ sẽ là <code>Java_com_example_securekeygen_MainActivity_check</code> (vì tên của package là <code>com.example.securekeygen</code>)</li><li>Nếu trong code Java có đoạn code <code>System.loadLibrary(&quot;nativeCheck&quot;)</code> thì file chứa code C/C++ sẽ là file <code>libnativeCheck.so</code>. File này có thể lấy được bằng cách giải nén file apk ra và tìm ở tròng đó.</li></ul><blockquote><p>File apk thật ra cũng chỉ là file zip, các bạn có thể đổi tên nó về thành .zip rồi dùng winrar để giải nén nó.</p></blockquote><p>Sau khi giải nén, các bạn sẽ tìm thấy tận 4 file có tên là <code>libnativeCheck.so</code>, 4 file này nằm ở 4 thư mục khác nhau là <code>arm64-v8a</code>, <code>armeabi-v7a</code>, <code>x86</code>, <code>x86_64</code>. Vậy ý nghĩa của 4 thư mục là gì?.</p><p>Đó là vì các điện thoại bây giờ có các loại chip khác nhau, có điện thoại dùng chip arm, có cái xài intel, có cái 32 bit và có cái 64 bit. Để đảm bảo app này chạy được trên mọi loại điện thoại thì mình đã include cả 4 file này vào. 4 file này có tác dụng y chang nhau, chỉ khác về loại assembly code. Nên nếu bạn thích x86 thì có thể chọn file trong thư mục <code>x86</code> để reverse, không thì chọn file trong các thư mục khác cũng chả sao. Mình sẽ chọn file trong thư mục <code>x86</code> để làm tiếp bài này. Mở file bằng IDA, chạy tới hàm <code>Java_com_example_securekeygen_MainActivity_check</code>:</p><pre><code class=\"language-c\"><span class=\"hljs-type\">bool</span> __cdecl <span class=\"hljs-title function_\">Java_com_example_securekeygen_MainActivity_check</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> a1, <span class=\"hljs-type\">int</span> a2, <span class=\"hljs-type\">int</span> a3, <span class=\"hljs-type\">int</span> a4)</span>{  <span class=\"hljs-comment\">// [COLLAPSED LOCAL DECLARATIONS. PRESS KEYPAD CTRL-&quot;+&quot; TO EXPAND]</span>  v4 = (<span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *)(*(<span class=\"hljs-type\">int</span> (__cdecl **)(<span class=\"hljs-type\">int</span>, <span class=\"hljs-type\">int</span>, _DWORD))(*(_DWORD *)a1 + <span class=\"hljs-number\">676</span>))(a1, a3, <span class=\"hljs-number\">0</span>);  v5 = strdup(v4);  (*(<span class=\"hljs-type\">void</span> (__cdecl **)(<span class=\"hljs-type\">int</span>, <span class=\"hljs-type\">int</span>, <span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *))(*(_DWORD *)a1 + <span class=\"hljs-number\">680</span>))(a1, a3, v4);  v21 = v5;  v26 = <span class=\"hljs-built_in\">strlen</span>(v5);  v7 = (<span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *)(*(<span class=\"hljs-type\">int</span> (__cdecl **)(<span class=\"hljs-type\">int</span>, <span class=\"hljs-type\">int</span>, _DWORD))(*(_DWORD *)a1 + <span class=\"hljs-number\">676</span>))(a1, a4, <span class=\"hljs-number\">0</span>);  v28 = strdup(v7);  v19 = v7;  v8 = v26;  (*(<span class=\"hljs-type\">void</span> (__cdecl **)(<span class=\"hljs-type\">int</span>, <span class=\"hljs-type\">int</span>))(*(_DWORD *)a1 + <span class=\"hljs-number\">680</span>))(a1, a4);  v22 = <span class=\"hljs-number\">2</span> * v26;  v9 = <span class=\"hljs-built_in\">malloc</span>(<span class=\"hljs-number\">2</span> * v26 + <span class=\"hljs-number\">1</span>);  v27 = (<span class=\"hljs-type\">char</span> *)<span class=\"hljs-built_in\">malloc</span>(<span class=\"hljs-number\">4</span> * v26 + <span class=\"hljs-number\">1</span>);  v23 = v9;  <span class=\"hljs-keyword\">if</span> ( v26 &lt;= <span class=\"hljs-number\">0</span> )  {    v10 = <span class=\"hljs-number\">0</span>;  }  <span class=\"hljs-keyword\">else</span>  {    <span class=\"hljs-built_in\">memcpy</span>(v9, v21, v26);    v10 = v26;  }  <span class=\"hljs-keyword\">if</span> ( v22 &lt;= v10 )  {    v14 = v10;  }  <span class=\"hljs-keyword\">else</span>  {    v24 = v22 + ~v10;    v11 = v26;    v12 = ((_BYTE)v22 - (_BYTE)v10) &amp; <span class=\"hljs-number\">3</span>;    <span class=\"hljs-keyword\">if</span> ( (((_BYTE)v22 - (_BYTE)v10) &amp; <span class=\"hljs-number\">3</span>) != <span class=\"hljs-number\">0</span> )    {      v13 = v23;      <span class=\"hljs-keyword\">do</span>      {        v23[v10++] = v21[--v11];        --v12;      }      <span class=\"hljs-keyword\">while</span> ( v12 );    }    <span class=\"hljs-keyword\">else</span>    {      v13 = v23;    }    v14 = <span class=\"hljs-number\">2</span> * v26;    v9 = v13;    v8 = v26;    <span class=\"hljs-keyword\">if</span> ( v24 &gt;= <span class=\"hljs-number\">3</span> )    {      v15 = &amp;v21[v11 - <span class=\"hljs-number\">1</span>];      <span class=\"hljs-keyword\">do</span>      {        v13[v10] = *v15;        v13[v10 + <span class=\"hljs-number\">1</span>] = *(v15 - <span class=\"hljs-number\">1</span>);        v13[v10 + <span class=\"hljs-number\">2</span>] = *(v15 - <span class=\"hljs-number\">2</span>);        v13[v10 + <span class=\"hljs-number\">3</span>] = *(v15 - <span class=\"hljs-number\">3</span>);        v10 += <span class=\"hljs-number\">4</span>;        v15 -= <span class=\"hljs-number\">4</span>;      }      <span class=\"hljs-keyword\">while</span> ( v22 != v10 );      v14 = <span class=\"hljs-number\">2</span> * v26;      v8 = v26;    }  }  v25 = <span class=\"hljs-number\">4</span> * v8;  v9[v14] = <span class=\"hljs-number\">0</span>;  <span class=\"hljs-keyword\">if</span> ( v8 &gt; <span class=\"hljs-number\">0</span> )  {    v16 = <span class=\"hljs-number\">0</span>;    v17 = v27;    <span class=\"hljs-keyword\">do</span>    {      sub_950(v17, <span class=\"hljs-number\">-1</span>, v19, v23[v16++]);      v17 += <span class=\"hljs-number\">2</span>;    }    <span class=\"hljs-keyword\">while</span> ( v16 &lt; v22 );  }  v27[v25] = <span class=\"hljs-number\">0</span>;  v20 = <span class=\"hljs-built_in\">strcmp</span>(v27, v28) == <span class=\"hljs-number\">0</span>;  <span class=\"hljs-built_in\">free</span>(v27);  <span class=\"hljs-built_in\">free</span>(v23);  <span class=\"hljs-built_in\">free</span>(v21);  <span class=\"hljs-built_in\">free</span>(v28);  <span class=\"hljs-keyword\">return</span> v20;}</code></pre><p>Bạn có thể đổi type của biến <code>a1</code> thành <code>JNIEnv*</code>, sau đó code sẽ trông rất đẹp. Các đoạn code kiểu như:</p><pre><code class=\"language-c\">(*(<span class=\"hljs-type\">void</span> (__cdecl **)(<span class=\"hljs-type\">int</span>, <span class=\"hljs-type\">int</span>, <span class=\"hljs-type\">const</span> <span class=\"hljs-type\">char</span> *))(*(_DWORD *)a1 + <span class=\"hljs-number\">680</span>))(a1, a3, v4);</code></pre><p>sẽ được đổi thành</p><pre><code class=\"language-c\">(*a1)-&gt;ReleaseStringUTFChars(a1, (jstring)a3, v4);</code></pre><p><strong>Cách giải 1: static</strong></p><p>Chỉ bằng việc đọc code, ta có thể thấy nó làm các việc sau: (viết theo syntax python cho ngắn)</p><ul><li><code>tmp = name + name[::-1]</code></li><li><code>tmp = hex_encode(tmp)</code></li><li>So sánh tmp với key.</li></ul><p><strong>Cách giải 2: dynamic</strong></p><ul><li>TODO</li></ul><h3>Flag</h3><pre><code>f0rtn1ght{68636d757340666f72746e69676874746867696e74726f664073756d6368}</code></pre>","list":[]}]}]}]}