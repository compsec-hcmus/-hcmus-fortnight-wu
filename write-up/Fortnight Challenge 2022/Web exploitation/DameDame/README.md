## Fortnight challenge 2022: Dame dame

![warmup category](https://img.shields.io/badge/Category-web-brightgreen.svg)  
![score](https://img.shields.io/badge/Score_after_CTF-200-blue.svg)  
![author](https://img.shields.io/badge/Author-Hai%20Le%238679-blue.svg)  
![solves](https://img.shields.io/badge/Solves-50-lightgrey.svg)

### Description
MD5 is sooo cool lol. How can people possibly get access to my admin panel, even I can't either lmao.

### Hints
- none

### Attached files
[index.php](https://github.com/compsec-hcmus/hcmus-wu/raw/main/write-up/Fortnight%20Challenge%202022/Web%20exploitation/DameDame/index.php)

### Summary
> Giới thiệu về **magic hash**

### Detailed solution
Đây là 1 challenge khá đơn giản và rất dễ thấy với những ai đã biết về thuật ngữ `magic hash`.

Để web app gửi về flag, 3 điều kiện cần phải được thỏa mãn:
1. `$_POST["username"] == $username`
2. `md5($_POST["password"]) == md5($password)`
3. `$_POST["password"] != $password`

Để qua được 2 điều kiện đầu thì chỉ cần nhập đúng `username` và `password` có trong file, nhưng cách đó sẽ không thỏa được điều kiện thứ 3. Mục tiêu hiện tại là cần tìm ra 1 `password` sao cho `md5($pasword) == md5("240610708")` và `$password != "240610708"`.

Các bạn có thể thấy phép so sánh được sử dụng là `==` thay vì `===`. Cách này không được khuyến khích vì phép so sánh `==` có thể xảy ra những trường hợp ngoại lệ vì PHP sẽ cố "cast" 2 giá trị về cùng 1 kiểu dữ liệu và so sánh.

![](https://ruempler.eu/2015/01/03/the-php-equality-table/table.png)

Điều này dẫn ra một phương pháp tấn công với những trang web sử dụng authentication bằng cách hash mật khẩu. Ví dụ với snippet sau:

```php
if (0 == "0e123123123123123") {
  echo "equal";
}
```
`equal` sẽ được in ra, vì khi sử dụng phép so sánh `==`, php sẽ thử chuyển giá trị `0e123123123123123` về dạng `integer`. Khi đó, 0<sup>123123123123123</sup> = 0

Nghĩa là nếu 2 mật khẩu hoàn toàn khác nhau nhưng hash của chúng có dạng `/0e[0-9]+/`, việc sử dụng phép so sánh `==` sẽ làm chương trình tưởng rằng đó là 1 mật khẩu, dẫn tới lỗ hổng về authentication. Các giá trị hash được nói ở trên được gọi chung là `magic hash`.


Và tình cờ thay, mật khẩu của admin trong challenge này cũng là một magic hash
```php
echo md5("240610708"); // 0e462097431906509019562988736854
```

Tóm lại, để vượt qua điều kiện thứ 3 của challenge này thì bạn chỉ cần truyền đúng `username` và `password` là 1 magic hash của hàm `md5`, danh sách các magic hash có thể tìm thấy rất nhiều trên mạng, mình lấy con số `240610708` từ [trang github này](https://github.com/spaze/hashes/blob/master/md5.md)

```bash
> curl -X POST --url "http://103.245.249.107:35000/" -d "username=admin&password=NWWKITQ"

Well done, here is your flag f0rtn1ght{0h_so_M4g1c_h4Sh_i5_a_tH1ng_hUh?}
```

### Flag
```
f0rtn1ght{0h_so_M4g1c_h4Sh_i5_a_tH1ng_hUh?}
```
